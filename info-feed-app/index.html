<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ÊÉÖÂ†±ÂèéÈõÜ„ÉÑ„Éº„É´ <span style="font-size: 0.7em; color: #666;">Ver.0.6.1</span></title>
  
  <!-- PWAÁî®„É°„Çø„Çø„Ç∞ -->
  <link rel="manifest" href="manifest.json">
  
  <!-- iOS SafariÂØæÂøú -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="ÊÉÖÂ†±ÂèéÈõÜ„ÉÑ„Éº„É´">
  <link rel="apple-touch-icon" href="icon-192.png">
  <link rel="apple-touch-icon" sizes="192x192" href="icon-192.png">
  <link rel="apple-touch-icon" sizes="512x512" href="icon-512.png">
  
  <!-- Android ChromeÂØæÂøú -->
  <meta name="theme-color" content="#007cba">
  <meta name="mobile-web-app-capable" content="yes">
  <style>
    body {
      font-family: sans-serif;
      padding: 1rem;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    h1 {
      font-size: 2rem;
      margin-bottom: 1rem;
      color: #333;
    }
    
    .tabs {
      display: flex;
      margin-bottom: 2rem;
      border-bottom: 2px solid #ddd;
    }
    
    .tab {
      padding: 0.5rem 1rem;
      background: none;
      border: none;
      cursor: pointer;
      font-size: 1rem;
      border-bottom: 2px solid transparent;
    }
    
    .tab.active {
      border-bottom-color: #007cba;
      color: #007cba;
      font-weight: bold;
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    /* FeedÁÆ°ÁêÜ */
    .feed-form {
      margin-bottom: 2rem;
      padding: 1rem;
      border: 1px solid #ddd;
      border-radius: 8px;
      background-color: #f9f9f9;
    }
    
    .feed-form input {
      width: 70%;
      padding: 0.5rem;
      margin-right: 0.5rem;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    
    .feed-form button {
      padding: 0.5rem 1rem;
      background-color: #007cba;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    
    .feed-list {
      list-style: none;
      padding: 0;
    }
    
    .feed-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem;
      margin-bottom: 0.5rem;
      border: 1px solid #ddd;
      border-radius: 4px;
      background-color: #f9f9f9;
    }
    
    .feed-item button {
      background-color: #dc3545;
      color: white;
      border: none;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      cursor: pointer;
    }
    
    /* Ë®ò‰∫ãË°®Á§∫ */
    .controls {
      margin-bottom: 1rem;
      display: flex;
      gap: 1rem;
      align-items: center;
    }
    
    .controls button {
      padding: 0.5rem 1rem;
      background-color: #28a745;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    
    .section {
      margin-bottom: 2rem;
    }
    
    .section h2 {
      margin-top: 2rem;
      font-size: 1.5rem;
      color: #333;
      border-bottom: 2px solid #ddd;
      padding-bottom: 0.5rem;
    }
    
    .article {
      margin-bottom: 1rem;
      padding: 1rem;
      border: 1px solid #ccc;
      border-radius: 8px;
      background-color: #f9f9f9;
    }
    
    .article h3 {
      margin: 0 0 0.5rem;
      font-size: 1.1rem;
    }
    
    .article a {
      text-decoration: none;
      color: #007cba;
    }
    
    .article a:hover {
      text-decoration: underline;
    }
    
    .article p {
      margin: 0.5rem 0;
      color: #666;
    }
    
    .article .meta {
      font-size: 0.9rem;
      color: #888;
      margin: 0.5rem 0;
    }
    
    .article .actions {
      margin-top: 0.5rem;
      display: flex;
      gap: 0.5rem;
    }
    
    .article button {
      font-size: 0.8rem;
      padding: 0.3rem 0.6rem;
      border: 1px solid #999;
      border-radius: 4px;
      cursor: pointer;
    }
    
    .read-button {
      background-color: #28a745;
      color: white;
      border-color: #28a745;
    }
    
    .summary-button {
      background-color: #007cba;
      color: white;
      border-color: #007cba;
    }

    .producthunt-summary-button {
      background-color: #da552f;
      color: white;
      border-color: #da552f;
    }
    
    .summary-button:disabled {
      background-color: #6c757d;
      border-color: #6c757d;
      cursor: not-allowed;
    }
    
    .summary {
      margin-top: 0.5rem;
      padding: 0.5rem;
      background-color: #e9ecef;
      border-radius: 4px;
      border-left: 4px solid #007cba;
    }
    
    .transcript-status {
      font-size: 0.8rem;
      margin-left: 0.5rem;
      padding: 0.2rem 0.4rem;
      border-radius: 3px;
      background-color: #f8f9fa;
    }
    
    .error-message {
      margin-top: 0.5rem;
      padding: 0.5rem;
      border-radius: 4px;
      font-size: 0.9rem;
    }
    
    .loading {
      color: #6c757d;
      font-style: italic;
    }
    
    .error {
      color: #dc3545;
    }
    
    .progress-indicator {
      display: inline-block;
      width: 1rem;
      height: 1rem;
      border: 2px solid #f3f3f3;
      border-top: 2px solid #007cba;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-right: 0.5rem;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* „É¢„Éº„ÉÄ„É´„Çπ„Çø„Ç§„É´ */
    .modal {
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.4);
    }
    
    .modal-content {
      background-color: #fefefe;
      margin: 10% auto;
      padding: 0;
      border: none;
      border-radius: 8px;
      width: 80%;
      max-width: 600px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    .modal-header {
      padding: 1rem;
      border-bottom: 1px solid #ddd;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .modal-header h3 {
      margin: 0;
      color: #333;
    }
    
    .close {
      color: #aaa;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }
    
    .close:hover,
    .close:focus {
      color: #000;
      text-decoration: none;
    }
    
    .modal-body {
      padding: 1rem;
    }
    
    .modal-body textarea {
      width: 100%;
      margin: 1rem 0;
      padding: 0.5rem;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-family: inherit;
      resize: vertical;
    }
    
    .modal-actions {
      display: flex;
      gap: 1rem;
      justify-content: flex-end;
      margin-top: 1rem;
    }
    
    .modal-actions button {
      padding: 0.5rem 1rem;
      border: 1px solid #ddd;
      border-radius: 4px;
      cursor: pointer;
      background-color: white;
    }
    
    .modal-actions button.primary {
      background-color: #007cba;
      color: white;
      border-color: #007cba;
    }
    
    .manual-summary-button {
      background-color: #28a745;
      color: white;
      border-color: #28a745;
    }
    
    /* „Éó„É≠„Ç∞„É¨„Çπ„Éê„Éº */
    .progress-container {
      margin-top: 0.5rem;
      padding: 0.5rem;
      background-color: #f8f9fa;
      border-radius: 4px;
      border-left: 4px solid #007cba;
    }
    
    .progress-bar {
      width: 100%;
      height: 8px;
      background-color: #e9ecef;
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 0.5rem;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #007cba, #28a745);
      border-radius: 4px;
      transition: width 0.3s ease;
      animation: progress-animation 2s infinite;
    }
    
    @keyframes progress-animation {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    
    .progress-text {
      font-size: 0.9rem;
      color: #495057;
      display: flex;
      align-items: center;
    }
    
    .progress-text::before {
      content: '';
      display: inline-block;
      width: 1rem;
      height: 1rem;
      border: 2px solid #f3f3f3;
      border-top: 2px solid #007cba;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-right: 0.5rem;
    }
  </style>
</head>
<body>
  <h1>ÊÉÖÂ†±ÂèéÈõÜ„ÉÑ„Éº„É´ <small style="font-size: 0.6em; color: #666;">Ver.0.6.1</small></h1>
  
  <div class="tabs">
    <button class="tab active" onclick="switchTab('articles')">Ë®ò‰∫ã‰∏ÄË¶ß</button>
    <button class="tab" onclick="switchTab('feeds')">FeedÁÆ°ÁêÜ</button>
  </div>
  
  <!-- Ë®ò‰∫ã‰∏ÄË¶ß„Çø„Éñ -->
  <div id="articles-tab" class="tab-content active">
    <div class="controls">
      <button onclick="refreshArticles()">Ë®ò‰∫ã„ÇíÊõ¥Êñ∞</button>
      <button onclick="refreshProductHunt()" style="background-color: #da552f;">
        üöÄ Product HuntÊõ¥Êñ∞
      </button>
      <label>
        <input type="checkbox" id="unread-only" checked onchange="loadArticles(false)">
        Êú™Ë™≠„ÅÆ„ÅøË°®Á§∫
      </label>
    </div>
    <div id="articles-container"></div>
  </div>
  
  <!-- FeedÁÆ°ÁêÜ„Çø„Éñ -->
  <div id="feeds-tab" class="tab-content">
    <div class="feed-form">
      <h3>RSS Feed „ÇíËøΩÂä†</h3>
      <input type="url" id="feed-url" placeholder="RSS Feed URL „ÇíÂÖ•Âäõ">
      <button onclick="addFeed()">ËøΩÂä†</button>
    </div>
    
    <h3>ÁôªÈå≤Ê∏à„ÅøFeed</h3>
    <ul id="feeds-list" class="feed-list"></ul>
  </div>

  <!-- ÊâãÂãïË¶ÅÁ¥Ñ„É¢„Éº„ÉÄ„É´ -->
  <div id="manual-summary-modal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3>ÊâãÂãï„ÉÜ„Ç≠„Çπ„ÉàÂÖ•Âäõ„ÅßË¶ÅÁ¥Ñ</h3>
        <span class="close" onclick="closeManualSummaryModal()">&times;</span>
      </div>
      <div class="modal-body">
        <p>ÂãïÁîª„ÇÑË®ò‰∫ã„ÅÆÂÜÖÂÆπ„Çí‰∏ãË®ò„Å´ÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇAI„ÅåË¶ÅÁ¥Ñ„ÇíÁîüÊàê„Åó„Åæ„Åô„ÄÇ</p>
        <textarea id="manual-text-input" placeholder="ÂÜÖÂÆπ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ..." rows="8"></textarea>
        <div class="modal-actions">
          <button onclick="closeManualSummaryModal()">„Ç≠„É£„É≥„Çª„É´</button>
          <button onclick="submitManualSummary()" class="primary">Ë¶ÅÁ¥Ñ„Çí‰ΩúÊàê</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // API Base URL „ÅÆË®≠ÂÆöÔºàÊú¨Áï™Áí∞Â¢É„Å®„É≠„Éº„Ç´„É´Áí∞Â¢É„Å´ÂØæÂøúÔºâ
    const API_BASE = window.location.origin.includes('localhost') || 
                     window.location.origin.includes('127.0.0.1') ? 
                     '' : // „É≠„Éº„Ç´„É´Áí∞Â¢É„Åß„ÅØÁõ∏ÂØæ„Éë„Çπ
                     window.location.origin; // Êú¨Áï™Áí∞Â¢É„Åß„ÅØ„Éï„É´„Éë„Çπ
    
    console.log('üîß API_BASE configured:', API_BASE);
    console.log('üîß Current origin:', window.location.origin);
    
    // Êó•Êú¨Ë™û„ÉÜ„Ç≠„Çπ„Éà„ÇíÊåáÂÆöÊñáÂ≠óÊï∞„ÅßÂàá„ÇäÊç®„Å¶„ÇãÈñ¢Êï∞
    function truncateText(text, maxLength = 100) {
      if (!text || typeof text !== 'string') return '';
      
      // Êó•Êú¨Ë™ûÊñáÂ≠ó„ÇíÊï∞„Åà„ÇãÔºàÂÖ®ËßíÊñáÂ≠ó„ÉªÂçäËßíÊñáÂ≠ó„ÇíÂå∫Âà•„Åó„Å™„ÅÑÔºâ
      if (text.length <= maxLength) {
        return text;
      }
      
      // maxLengthÊñáÂ≠ó„ÅßÂàá„ÇäÊç®„Å¶„ÄÅÊúÄÂæå„Å´„Äå...„Äç„ÇíËøΩÂä†
      const truncated = text.substring(0, maxLength);
      
      // Êñá„ÅÆÈÄî‰∏≠„ÅßÂàá„Çå„Å™„ÅÑ„Çà„ÅÜ„Å´„ÄÅÂèØËÉΩ„Å™„ÇâÂè•ÁÇπ„ÅßÂàá„Çã
      const lastPunctuation = Math.max(
        truncated.lastIndexOf('„ÄÇ'),
        truncated.lastIndexOf('„ÄÅ'),
        truncated.lastIndexOf('ÔºÅ'),
        truncated.lastIndexOf('Ôºü'),
        truncated.lastIndexOf('.'),
        truncated.lastIndexOf(','),
        truncated.lastIndexOf('!'),
        truncated.lastIndexOf('?')
      );
      
      if (lastPunctuation > maxLength * 0.7) {
        // Âè•ÁÇπ„Åå70%‰ª•Èôç„Å´„ÅÇ„ÇãÂ†¥Âêà„ÅØ„Åù„Åì„ÅßÂàá„Çã
        return truncated.substring(0, lastPunctuation + 1) + '...';
      } else {
        // „Åù„ÅÜ„Åß„Å™„Åë„Çå„Å∞„Åù„ÅÆ„Åæ„ÅæÂàá„Çã
        return truncated + '...';
      }
    }
    
    // „Çø„ÉñÂàá„ÇäÊõø„Åà
    function switchTab(tabName) {
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
      
      event.target.classList.add('active');
      document.getElementById(tabName + '-tab').classList.add('active');
      
      if (tabName === 'articles') {
        loadArticles();
      } else if (tabName === 'feeds') {
        loadFeeds();
      }
    }
    
    // Ë®ò‰∫ã‰∏ÄË¶ß„ÅÆË™≠„ÅøËæº„Åø
    let currentOffset = 0;
    const articlesPerPage = 25;  // Ë§áÊï∞FeedÁôªÈå≤ÊôÇ„Åß„ÇÇÂçÅÂàÜ„Å™Ë°®Á§∫Êï∞„ÇíÁ¢∫‰øù
    
    async function loadArticles(loadMore = false) {
      const unreadOnly = document.getElementById('unread-only').checked;
      const container = document.getElementById('articles-container');
      
      if (!loadMore) {
        currentOffset = 0;
        container.innerHTML = '';
      }
      
      try {
        const response = await fetch(`${API_BASE}/api/articles?unread_only=${unreadOnly}&limit=${articlesPerPage}&offset=${currentOffset}`);
        const data = await response.json();
        
        if (data.articles.length === 0) {
          if (currentOffset === 0) {
            container.innerHTML = '<p>Ë®ò‰∫ã„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>';
          }
          return;
        }
        
        // „Ç≥„É≥„ÉÜ„É≥„ÉÑ„Çø„Ç§„Éó„Åî„Å®„Å´„Ç∞„É´„Éº„ÉóÂåñ
        const typeLabels = {
          'youtube': 'YouTubeÂãïÁîª',
          'podcast': 'Podcast',
          'producthunt': 'Product Hunt',
          'article': 'WebË®ò‰∫ã'
        };
        
        if (loadMore) {
          // ËøΩÂä†Ë™≠„ÅøËæº„Åø„ÅÆÂ†¥Âêà„ÄÅÊó¢Â≠ò„ÅÆ„Ç≥„É≥„ÉÜ„É≥„ÉÑ„Å´ËøΩÂä†
          data.articles.forEach(article => {
            const existingSection = container.querySelector(`[data-type="${article.content_type}"]`);
            if (existingSection) {
              const articleEl = createArticleElement(article);
              existingSection.appendChild(articleEl);
            } else {
              // Êñ∞„Åó„ÅÑ„Çø„Ç§„Éó„ÅÆÂ†¥Âêà„ÅØÊñ∞„Åó„ÅÑ„Çª„ÇØ„Ç∑„Éß„É≥„Çí‰ΩúÊàê
              const section = document.createElement('div');
              section.className = 'section';
              section.dataset.type = article.content_type;
              
              const header = document.createElement('h2');
              header.textContent = typeLabels[article.content_type] || article.content_type;
              section.appendChild(header);
              
              const articleEl = createArticleElement(article);
              section.appendChild(articleEl);
              
              container.appendChild(section);
            }
          });
        } else {
          // ÂàùÂõûË™≠„ÅøËæº„Åø„ÅÆÂ†¥Âêà
          Object.entries(data.grouped).forEach(([type, articles]) => {
            const section = document.createElement('div');
            section.className = 'section';
            section.dataset.type = type;
            
            const header = document.createElement('h2');
            header.textContent = typeLabels[type] || type;
            section.appendChild(header);
            
            articles.forEach(article => {
              const articleEl = createArticleElement(article);
              section.appendChild(articleEl);
            });
            
            container.appendChild(section);
          });
        }
        
        currentOffset += data.articles.length;
        
        // „Äå„ÇÇ„Å£„Å®Ë¶ã„Çã„Äç„Éú„Çø„É≥„ÇíÊõ¥Êñ∞
        updateLoadMoreButton(data.articles.length === articlesPerPage);
        
      } catch (error) {
        console.error('Error loading articles:', error);
        if (currentOffset === 0) {
          container.innerHTML = '<p class="error">Ë®ò‰∫ã„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü</p>';
        }
      }
    }
    
    function updateLoadMoreButton(hasMore) {
      let loadMoreBtn = document.getElementById('load-more-btn');
      
      if (hasMore) {
        if (!loadMoreBtn) {
          loadMoreBtn = document.createElement('button');
          loadMoreBtn.id = 'load-more-btn';
          loadMoreBtn.textContent = '„ÇÇ„Å£„Å®Ë¶ã„Çã';
          loadMoreBtn.style.cssText = 'display: block; margin: 20px auto; padding: 10px 20px; background: #007cba; color: white; border: none; border-radius: 4px; cursor: pointer;';
          loadMoreBtn.onclick = () => loadArticles(true);
          
          const container = document.getElementById('articles-container');
          container.parentNode.insertBefore(loadMoreBtn, container.nextSibling);
        }
        loadMoreBtn.style.display = 'block';
      } else {
        if (loadMoreBtn) {
          loadMoreBtn.style.display = 'none';
        }
      }
    }
    
    // Ë®ò‰∫ãË¶ÅÁ¥†„ÅÆ‰ΩúÊàê
    function createArticleElement(article) {
      const div = document.createElement('div');
      div.className = 'article';
      div.dataset.id = article.id;
      
      const pubDate = new Date(article.pub_date).toLocaleDateString('ja-JP');
      
      div.innerHTML = `
        <h3><a href="${article.link}" target="_blank">${article.title}</a></h3>
        <p>${truncateText(article.description || '', 100)}</p>
        <div class="meta">
          ${article.feed_title} / ${pubDate}
          ${article.content_type === 'youtube' ? '<span class="transcript-status" id="transcript-status-' + article.id + '">üîç „Ç≥„É≥„ÉÜ„É≥„ÉÑÁ¢∫Ë™ç‰∏≠...</span>' : ''}
        </div>
        <div class="actions">
          <button class="read-button" onclick="markAsRead(${article.id})">
            ‚úì Êó¢Ë™≠„Å´„Åô„Çã
          </button>
          ${article.content_type === 'youtube' ? 
            `<button class="youtube-summary-button" id="youtube-summary-btn-${article.id}" onclick="requestYouTubeSummary(${article.id})" 
                     ${article.summary_status === 'processing' ? 'disabled' : ''}>
              üé¨ ÂãïÁîªË¶ÅÁ¥Ñ
            </button>` : ''}
          ${article.content_type === 'podcast' ? 
            `<button class="audio-summary-button" id="audio-summary-btn-${article.id}" onclick="requestAudioSummary(${article.id})" 
                     ${article.summary_status === 'processing' ? 'disabled' : ''}>
              üéß Èü≥Â£∞Ë¶ÅÁ¥Ñ
            </button>` : ''}
          ${article.content_type === 'producthunt' ? 
            `<button class="producthunt-summary-button" id="producthunt-summary-btn-${article.id}" onclick="requestManualSummary(${article.id})" 
                     ${article.summary_status === 'processing' ? 'disabled' : ''}>
              üöÄ „Ç¢„Éó„É™Ë¶ÅÁ¥Ñ
            </button>
            <a href="${article.link}" target="_blank" class="producthunt-link" style="text-decoration: none;">
              <button style="background-color: #da552f; color: white; margin-left: 0.5rem;">
                üîó Product Hunt
              </button>
            </a>` : ''}
          <button class="manual-summary-button" onclick="showManualSummaryModal(${article.id})">
            ‚úèÔ∏è ÊâãÂãïË¶ÅÁ¥Ñ
          </button>
        </div>
        ${article.summary_text ? `<div class="summary">${truncateText(article.summary_text, 100)}</div>` : ''}
        <div class="progress-container" id="progress-container-${article.id}" style="display: none;">
          <div class="progress-bar">
            <div class="progress-fill" id="progress-fill-${article.id}"></div>
          </div>
          <div class="progress-text" id="progress-text-${article.id}">Âá¶ÁêÜ‰∏≠...</div>
        </div>
        <div class="error-message" id="error-message-${article.id}" style="display: none;"></div>
      `;
      
      // YouTubeÂãïÁîª„ÅÆÂ†¥Âêà„ÅØÂ≠óÂπï„ÉÅ„Çß„ÉÉ„ÇØ„ÇíÂÆüË°å
      if (article.content_type === 'youtube') {
        checkTranscriptAvailability(article.id);
      }
      
      return div;
    }
    
    function getSummaryButtonText(status) {
      switch (status) {
        case 'pending': return 'Ë¶ÅÁ¥Ñ„Çí‰ΩúÊàê';
        case 'processing': return 'Ë¶ÅÁ¥Ñ‰∏≠...';
        case 'completed': return 'Ë¶ÅÁ¥ÑÂÆå‰∫Ü';
        case 'failed': return 'Ë¶ÅÁ¥ÑÂ§±Êïó';
        default: return 'Ë¶ÅÁ¥Ñ„Çí‰ΩúÊàê';
      }
    }
    
    // Êó¢Ë™≠„Éû„Éº„ÇØ
    async function markAsRead(articleId) {
      try {
        const response = await fetch(`${API_BASE}/api/articles/${articleId}/read`, {
          method: 'PATCH',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ read_status: true })
        });
        
        if (response.ok) {
          const articleEl = document.querySelector(`[data-id="${articleId}"]`);
          if (articleEl) {
            articleEl.remove();
          }
        }
      } catch (error) {
        console.error('Error marking as read:', error);
      }
    }
    
    // Èü≥Â£∞Ë¶ÅÁ¥Ñ„É™„ÇØ„Ç®„Çπ„ÉàÈñ¢Êï∞„ÇíËøΩÂä†
    async function requestAudioSummary(articleId) {
      // „É¶„Éº„Ç∂„ÉºÁ¢∫Ë™ç
      const confirmed = confirm('Èü≥Â£∞„Åã„Çâ„ÅÆË¶ÅÁ¥Ñ„ÇíÈñãÂßã„Åó„Åæ„Åô„ÅãÔºü\n\n„ÉªÂá¶ÁêÜÊôÇÈñì: 3-5ÂàÜÁ®ãÂ∫¶\n„ÉªAPI„Ç≥„Çπ„Éà„ÅåÁô∫Áîü„Åó„Åæ„Åô\n„ÉªÈÄî‰∏≠„Åß„Ç≠„É£„É≥„Çª„É´„ÅØ„Åß„Åç„Åæ„Åõ„Çì');
      
      if (!confirmed) {
        return;
      }
      
      const button = document.getElementById(`audio-summary-btn-${articleId}`);
      const progressContainer = document.getElementById(`progress-container-${articleId}`);
      const progressText = document.getElementById(`progress-text-${articleId}`);
      const progressFill = document.getElementById(`progress-fill-${articleId}`);
      const errorContainer = document.getElementById(`error-message-${articleId}`);
      
      try {
        // UIÊõ¥Êñ∞
        button.disabled = true;
        button.textContent = 'Èü≥Â£∞Âá¶ÁêÜ‰∏≠...';
        progressContainer.style.display = 'block';
        errorContainer.style.display = 'none';
        
        // Èü≥Â£∞Ë¶ÅÁ¥Ñ„É™„ÇØ„Ç®„Çπ„Éà„ÇíÈÄÅ‰ø°
        const response = await fetch(`${API_BASE}/api/articles/${articleId}/summarize`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ audio_summary: true })
        });
        
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const data = await response.json();
        
        if (data.success) {
          // ÈÄ≤Ë°åÁä∂Ê≥Å„ÇíÁõ£Ë¶ñ
          monitorAudioSummaryProgress(articleId);
        } else {
          throw new Error(data.error || 'Èü≥Â£∞Ë¶ÅÁ¥Ñ„ÅÆÈñãÂßã„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
        }
        
      } catch (error) {
        console.error('Audio summary error:', error);
        
        // „Ç®„É©„ÉºË°®Á§∫
        errorContainer.textContent = `„Ç®„É©„Éº: ${error.message}`;
        errorContainer.style.display = 'block';
        progressContainer.style.display = 'none';
        
        // „Éú„Çø„É≥„ÇíÂÖÉ„Å´Êàª„Åô
        button.disabled = false;
        button.textContent = 'üéß Èü≥Â£∞Ë¶ÅÁ¥Ñ';
      }
    }
    
    // YouTubeÂãïÁîªË¶ÅÁ¥Ñ„É™„ÇØ„Ç®„Çπ„ÉàÈñ¢Êï∞
    async function requestYouTubeSummary(articleId) {
      // „É¶„Éº„Ç∂„ÉºÁ¢∫Ë™ç
      const confirmed = confirm('YouTubeÂãïÁîª„ÅÆË¶ÅÁ¥Ñ„ÇíÈñãÂßã„Åó„Åæ„Åô„ÅãÔºü\n\n„ÉªÂ≠óÂπï„Åå„ÅÇ„ÇãÂ†¥Âêà: 1-2ÂàÜÁ®ãÂ∫¶\n„ÉªÂ≠óÂπï„Åå„Å™„ÅÑÂ†¥Âêà: 3-5ÂàÜÁ®ãÂ∫¶ÔºàÈü≥Â£∞Âá¶ÁêÜÔºâ\n„ÉªAPI„Ç≥„Çπ„Éà„ÅåÁô∫Áîü„Åó„Åæ„Åô\n„ÉªÈÄî‰∏≠„Åß„Ç≠„É£„É≥„Çª„É´„ÅØ„Åß„Åç„Åæ„Åõ„Çì');
      
      if (!confirmed) {
        return;
      }
      
      const button = document.getElementById(`youtube-summary-btn-${articleId}`);
      const progressContainer = document.getElementById(`progress-container-${articleId}`);
      const errorContainer = document.getElementById(`error-message-${articleId}`);
      
      try {
        // UIÊõ¥Êñ∞
        button.disabled = true;
        button.textContent = 'ÂãïÁîªÂá¶ÁêÜ‰∏≠...';
        progressContainer.style.display = 'block';
        errorContainer.style.display = 'none';
        
        // YouTubeË¶ÅÁ¥Ñ„É™„ÇØ„Ç®„Çπ„Éà„ÇíÈÄÅ‰ø°
        const response = await fetch(`${API_BASE}/api/articles/${articleId}/summarize`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ youtube_summary: true })
        });
        
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const data = await response.json();
        
        if (data.success) {
          // ÈÄ≤Ë°åÁä∂Ê≥Å„ÇíÁõ£Ë¶ñ
          monitorYouTubeSummaryProgress(articleId);
        } else {
          throw new Error(data.error || 'YouTubeË¶ÅÁ¥Ñ„ÅÆÈñãÂßã„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
        }
        
      } catch (error) {
        console.error('YouTube summary error:', error);
        
        // „Çà„ÇäË©≥Á¥∞„Å™„Ç®„É©„Éº„É°„ÉÉ„Çª„Éº„Ç∏
        let errorMessage = error.message;
        if (errorMessage.includes('HTTP 404')) {
          errorMessage = 'Ë®ò‰∫ã„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„ÄÇ„Éö„Éº„Ç∏„ÇíÊõ¥Êñ∞„Åó„Å¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ';
        } else if (errorMessage.includes('HTTP 500')) {
          errorMessage = '„Çµ„Éº„Éê„Éº„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ„Åó„Å∞„Çâ„Åè„Åó„Å¶„Åã„ÇâÂÜçË©¶Ë°å„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ';
        } else if (errorMessage.includes('fetch')) {
          errorMessage = '„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇÊé•Á∂ö„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ';
        }
        
        // „Ç®„É©„ÉºË°®Á§∫
        errorContainer.textContent = `„Ç®„É©„Éº: ${errorMessage}`;
        errorContainer.style.display = 'block';
        progressContainer.style.display = 'none';
        
        // „Éú„Çø„É≥„ÇíÂÖÉ„Å´Êàª„Åô
        button.disabled = false;
        button.textContent = 'üé¨ ÂãïÁîªË¶ÅÁ¥Ñ';
      }
    }
    
    // Èü≥Â£∞Ë¶ÅÁ¥ÑÈÄ≤Ë°åÁä∂Ê≥ÅÁõ£Ë¶ñ
    async function monitorAudioSummaryProgress(articleId) {
      const progressText = document.getElementById(`progress-text-${articleId}`);
      const progressFill = document.getElementById(`progress-fill-${articleId}`);
      const button = document.getElementById(`audio-summary-btn-${articleId}`);
      
      const stages = [
        { text: 'Èü≥Â£∞„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ‰∏≠...', progress: 20 },
        { text: 'Èü≥Â£∞Ëª¢ÂÜô‰∏≠...', progress: 60 },
        { text: 'Ë¶ÅÁ¥ÑÁîüÊàê‰∏≠...', progress: 90 }
      ];
      
      let currentStage = 0;
      
      const updateProgress = () => {
        if (currentStage < stages.length) {
          const stage = stages[currentStage];
          progressText.textContent = stage.text;
          progressFill.style.width = stage.progress + '%';
          currentStage++;
        }
      };
      
      // ÂàùÊúü„Çπ„ÉÜ„Éº„Ç∏Ë®≠ÂÆö
      updateProgress();
      
      // ÂÆöÊúüÁöÑ„Å´ÈÄ≤Ë°åÁä∂Ê≥Å„Çí„ÉÅ„Çß„ÉÉ„ÇØ
      const progressInterval = setInterval(updateProgress, 10000); // 10Áßí„Åî„Å®
      
      // ÁµêÊûú„Çí„Éù„Éº„É™„É≥„Ç∞
      const checkResult = async () => {
        try {
          const response = await fetch(`${API_BASE}/api/articles/${articleId}/summary`);
          const data = await response.json();
          
          if ((data.request_status === 'completed' || data.summary_status === 'completed') && data.summary_text) {
            clearInterval(progressInterval);
            
            // ÊàêÂäüÊôÇ„ÅÆUIÊõ¥Êñ∞
            progressText.textContent = 'Ë¶ÅÁ¥ÑÂÆå‰∫ÜÔºÅ';
            progressFill.style.width = '100%';
            
            setTimeout(() => {
              document.getElementById(`progress-container-${articleId}`).style.display = 'none';
              
              const articleEl = document.querySelector(`[data-id="${articleId}"]`);
              if (articleEl) {
                let summaryDiv = articleEl.querySelector('.summary');
                if (!summaryDiv) {
                  summaryDiv = document.createElement('div');
                  summaryDiv.className = 'summary';
                  const actionsDiv = articleEl.querySelector('.actions');
                  actionsDiv.insertAdjacentElement('afterend', summaryDiv);
                }
                // ÊîπË°å„Çí<br>„Å´Â§âÊèõ„Åó„Å¶„Çµ„Éû„É™„ÉºÂÖ®‰Ωì„ÇíË°®Á§∫
                summaryDiv.innerHTML = data.summary_text.replace(/\n/g, '<br>');
              }
              
              // „Éú„Çø„É≥„ÇíÊõ¥Êñ∞
              if (button) {
                button.textContent = 'Ë¶ÅÁ¥ÑÂÆå‰∫Ü';
                button.disabled = true;
              }
            }, 1000);
            
          } else if (data.request_status === 'failed' || data.summary_status === 'failed') {
            clearInterval(progressInterval);
            
            // Â§±ÊïóÊôÇ„ÅÆUIÊõ¥Êñ∞
            const errorContainer = document.getElementById(`error-message-${articleId}`);
            errorContainer.textContent = `„Ç®„É©„Éº: ${data.error || 'Èü≥Â£∞Ë¶ÅÁ¥Ñ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü'}`;
            errorContainer.style.display = 'block';
            document.getElementById(`progress-container-${articleId}`).style.display = 'none';
            
            button.disabled = false;
            button.textContent = 'üéß Èü≥Â£∞Ë¶ÅÁ¥Ñ';
          } else {
            // „Åæ„Å†Âá¶ÁêÜ‰∏≠„ÅÆÂ†¥Âêà„ÄÅÁ∂ôÁ∂ö„Åó„Å¶„ÉÅ„Çß„ÉÉ„ÇØ
            setTimeout(checkResult, 5000); // 5ÁßíÂæå„Å´ÂÜç„ÉÅ„Çß„ÉÉ„ÇØ
          }
          
        } catch (error) {
          console.error('Progress check error:', error);
          setTimeout(checkResult, 10000); // „Ç®„É©„ÉºÊôÇ„ÅØ10ÁßíÂæå„Å´ÂÜçË©¶Ë°å
        }
      };
      
      // ÂàùÂõû„ÉÅ„Çß„ÉÉ„ÇØ„ÇíÂ∞ë„ÅóÈÅÖ„Çâ„Åõ„Å¶ÂÆüË°å
      setTimeout(checkResult, 3000);
    }
    
    // YouTubeÂãïÁîªË¶ÅÁ¥ÑÈÄ≤Ë°åÁä∂Ê≥ÅÁõ£Ë¶ñ
    async function monitorYouTubeSummaryProgress(articleId) {
      const progressText = document.getElementById(`progress-text-${articleId}`);
      const progressFill = document.getElementById(`progress-fill-${articleId}`);
      const button = document.getElementById(`youtube-summary-btn-${articleId}`);
      
      const stages = [
        { text: '„Ç≥„É≥„ÉÜ„É≥„ÉÑÁ¢∫Ë™ç‰∏≠...', progress: 10 },
        { text: 'Â≠óÂπïÂèñÂæó‰∏≠...', progress: 30 },
        { text: 'Èü≥Â£∞„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ‰∏≠...', progress: 50 },
        { text: 'Èü≥Â£∞ÊñáÂ≠óËµ∑„Åì„Åó‰∏≠...', progress: 70 },
        { text: 'Ë¶ÅÁ¥ÑÁîüÊàê‰∏≠...', progress: 90 }
      ];
      
      let currentStage = 0;
      const startTime = Date.now();
      const MAX_TIMEOUT = 10 * 60 * 1000; // 10ÂàÜ„Çø„Ç§„É†„Ç¢„Ç¶„Éà
      
      const updateProgress = () => {
        if (currentStage < stages.length) {
          const stage = stages[currentStage];
          progressText.textContent = stage.text;
          progressFill.style.width = stage.progress + '%';
          currentStage++;
        }
      };
      
      // ÂàùÊúü„Çπ„ÉÜ„Éº„Ç∏Ë®≠ÂÆö
      updateProgress();
      
      // ÂÆöÊúüÁöÑ„Å´ÈÄ≤Ë°åÁä∂Ê≥Å„Çí„ÉÅ„Çß„ÉÉ„ÇØ
      const progressInterval = setInterval(updateProgress, 15000); // 15Áßí„Åî„Å®
      
      // ÁµêÊûú„Çí„Éù„Éº„É™„É≥„Ç∞
      const checkResult = async () => {
        try {
          // „Çø„Ç§„É†„Ç¢„Ç¶„Éà„ÉÅ„Çß„ÉÉ„ÇØ
          const elapsed = Date.now() - startTime;
          if (elapsed > MAX_TIMEOUT) {
            clearInterval(progressInterval);
            
            console.log('‚è∞ YouTube summary timed out after', elapsed/1000, 'seconds');
            
            // „Çø„Ç§„É†„Ç¢„Ç¶„ÉàÊôÇ„ÅÆUIÊõ¥Êñ∞
            const errorContainer = document.getElementById(`error-message-${articleId}`);
            if (errorContainer) {
              errorContainer.textContent = '„Çø„Ç§„É†„Ç¢„Ç¶„Éà: Âá¶ÁêÜÊôÇÈñì„ÅåÈï∑„Åô„Åé„Åæ„Åô„ÄÇ„ÄåÊâãÂãïË¶ÅÁ¥Ñ„Äç„Çí„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ';
              errorContainer.style.display = 'block';
            }
            
            document.getElementById(`progress-container-${articleId}`).style.display = 'none';
            
            if (button) {
              button.disabled = false;
              button.textContent = 'üé¨ ÂãïÁîªË¶ÅÁ¥Ñ';
            }
            return;
          }
          
          const response = await fetch(`${API_BASE}/api/articles/${articleId}/summary`);
          const data = await response.json();
          
          console.log('üîç YouTube summary check result:', data); // „Éá„Éê„ÉÉ„Ç∞„É≠„Ç∞
          console.log('üîç Detailed status check:', {
            summary_status: data.summary_status,
            request_status: data.request_status,
            has_summary_text: !!data.summary_text,
            summary_text_length: data.summary_text ? data.summary_text.length : 0,
            error_message: data.error_message,
            timestamp: new Date().toISOString(),
            elapsed_seconds: elapsed/1000
          });
          
          // ÊàêÂäüÊù°‰ª∂„Çí„Çà„ÇäÂé≥ÂØÜ„Å´„ÉÅ„Çß„ÉÉ„ÇØ
          const isCompleted = data.summary_status === 'completed' || data.request_status === 'completed';
          const hasSummaryText = data.summary_text && data.summary_text.trim().length > 0;
          
          if (isCompleted && hasSummaryText) {
            clearInterval(progressInterval);
            
            // ÊàêÂäüÊôÇ„ÅÆUIÊõ¥Êñ∞
            progressText.textContent = 'Ë¶ÅÁ¥ÑÂÆå‰∫ÜÔºÅ';
            progressFill.style.width = '100%';
            
            // „Ç®„É©„Éº„Ç≥„É≥„ÉÜ„Éä„ÇíÈùûË°®Á§∫„Å´„Åô„Çã
            const errorContainer = document.getElementById(`error-message-${articleId}`);
            if (errorContainer) {
              errorContainer.style.display = 'none';
            }
            
            setTimeout(() => {
              document.getElementById(`progress-container-${articleId}`).style.display = 'none';
              
              const articleEl = document.querySelector(`[data-id="${articleId}"]`);
              if (articleEl) {
                let summaryDiv = articleEl.querySelector('.summary');
                if (!summaryDiv) {
                  summaryDiv = document.createElement('div');
                  summaryDiv.className = 'summary';
                  const actionsDiv = articleEl.querySelector('.actions');
                  actionsDiv.insertAdjacentElement('afterend', summaryDiv);
                }
                // ÊîπË°å„Çí<br>„Å´Â§âÊèõ„Åó„Å¶„Çµ„Éû„É™„ÉºÂÖ®‰Ωì„ÇíË°®Á§∫
                summaryDiv.innerHTML = data.summary_text.replace(/\n/g, '<br>');
              }
              
              // „Éú„Çø„É≥„ÇíÊõ¥Êñ∞
              if (button) {
                button.textContent = 'Ë¶ÅÁ¥ÑÂÆå‰∫Ü';
                button.disabled = true;
              }
            }, 1000);
            
          } else if (data.request_status === 'failed' || data.summary_status === 'failed') {
            clearInterval(progressInterval);
            
            console.log('‚ùå YouTube summary failed:', {
              request_status: data.request_status,
              summary_status: data.summary_status,
              error_message: data.error_message,
              methods_attempted: data.methods || 'unknown'
            });
            
            // „Ç®„É©„ÉºË°®Á§∫
            const errorContainer = document.getElementById(`error-message-${articleId}`);
            if (errorContainer) {
              errorContainer.textContent = `„Ç®„É©„Éº: ${data.error_message || 'YouTubeË¶ÅÁ¥Ñ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü'}`;
              errorContainer.style.display = 'block';
            }
            
            document.getElementById(`progress-container-${articleId}`).style.display = 'none';
            
            // „Éú„Çø„É≥„ÇíÂÖÉ„Å´Êàª„Åô
            if (button) {
              button.disabled = false;
              button.textContent = 'üé¨ ÂãïÁîªË¶ÅÁ¥Ñ';
            }
          } else if (data.summary_status === 'pending' || data.request_status === 'pending' || 
                     data.summary_status === 'processing' || data.request_status === 'processing') {
            // „Åæ„Å†Âá¶ÁêÜ‰∏≠ - Ê¨°Âõû„ÉÅ„Çß„ÉÉ„ÇØ
            setTimeout(checkResult, 8000); // 8Áßí„Å´Áü≠Á∏Æ
          } else {
            // ‰∫àÊúü„Åó„Å™„ÅÑÁä∂ÊÖã
            console.warn('Unexpected summary status:', data);
            setTimeout(checkResult, 10000);
          }
        } catch (error) {
          console.error('YouTube summary progress check error:', error);
          setTimeout(checkResult, 10000); // „Ç®„É©„ÉºÊôÇ„ÅØ10ÁßíÂæå„Å´ÂÜçË©¶Ë°å
        }
      };
      
      // ÂàùÂõû„ÉÅ„Çß„ÉÉ„ÇØ„ÇíÂ∞ë„ÅóÈÅÖ„Çâ„Åõ„Å¶ÂÆüË°å
      setTimeout(checkResult, 3000);
    }
    
    // YouTube „Ç≥„É≥„ÉÜ„É≥„ÉÑÂà©Áî®ÂèØËÉΩÊÄß„Çí„ÉÅ„Çß„ÉÉ„ÇØ
    async function checkTranscriptAvailability(articleId) {
      try {
        const response = await fetch(`${API_BASE}/api/articles/${articleId}/content-check`);
        const data = await response.json();
        
        const statusElement = document.getElementById(`transcript-status-${articleId}`);
        const summaryButton = document.getElementById(`summary-btn-${articleId}`);
        
        if (statusElement) {
          if (data.available) {
            const methodText = data.methods && data.methods.length > 0 ? 
              (data.methods.includes('transcript') ? 'üìÑ Â≠óÂπïÂà©Áî®ÂèØËÉΩ' : 'üìù Ë™¨ÊòéÊñáÂà©Áî®ÂèØËÉΩ') : 
              '‚úÖ Ë¶ÅÁ¥ÑÂèØËÉΩ';
            statusElement.textContent = methodText;
            statusElement.style.color = '#28a745';
          } else {
            statusElement.textContent = '‚ùå Ë¶ÅÁ¥Ñ‰∏çÂèØ';
            statusElement.style.color = '#dc3545';
            if (summaryButton) {
              summaryButton.disabled = true;
              summaryButton.textContent = '„Ç≥„É≥„ÉÜ„É≥„ÉÑ„Å™„ÅóÔºàË¶ÅÁ¥Ñ‰∏çÂèØÔºâ';
            }
          }
        }
      } catch (error) {
        console.error('Content check failed:', error);
        const statusElement = document.getElementById(`transcript-status-${articleId}`);
        if (statusElement) {
          statusElement.textContent = '‚ùì Á¢∫Ë™çÂ§±Êïó';
          statusElement.style.color = '#6c757d';
        }
      }
    }

    // Ë¶ÅÁ¥Ñ„É™„ÇØ„Ç®„Çπ„Éà
    async function requestSummary(articleId) {
      console.log(`üé¨ Starting requestSummary for article ${articleId}`);
      
      const button = document.getElementById(`summary-btn-${articleId}`);
      const errorElement = document.getElementById(`error-message-${articleId}`);
      const progressContainer = document.getElementById(`progress-container-${articleId}`);
      
      console.log(`üîç UI elements found:`, {
        hasButton: !!button,
        hasErrorElement: !!errorElement,
        hasProgressContainer: !!progressContainer
      });
      
      try {
        // „Ç®„É©„Éº„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÈö†„Åô
        if (errorElement) {
          errorElement.style.display = 'none';
          console.log(`üóëÔ∏è Hidden error element for article ${articleId}`);
        }
        
        console.log(`üì° Sending POST request to /api/articles/${articleId}/summarize`);
        const response = await fetch(`${API_BASE}/api/articles/${articleId}/summarize`, {
          method: 'POST'
        });
        
        console.log(`üì° Summary request response: ${response.status} ${response.statusText}`);
        
        if (response.ok) {
          const responseData = await response.json();
          console.log(`‚úÖ Summary request successful:`, responseData);
          
          if (button) {
            button.disabled = true;
            button.textContent = 'Ë¶ÅÁ¥Ñ‰∏≠...';
            console.log(`üîò Button updated for article ${articleId}: disabled=true, text='Ë¶ÅÁ¥Ñ‰∏≠...'`);
          }
          
          // „Éó„É≠„Ç∞„É¨„Çπ„Éê„Éº„ÇíË°®Á§∫
          console.log(`üìä Showing progress for article ${articleId}`);
          showProgress(articleId, 'Ë¶ÅÁ¥ÑÂá¶ÁêÜ„ÇíÈñãÂßã„Åó„Å¶„ÅÑ„Åæ„Åô...');
          
          // Ë¶ÅÁ¥ÑÂÆå‰∫Ü„ÇíÂÆöÊúüÁöÑ„Å´„ÉÅ„Çß„ÉÉ„ÇØ
          console.log(`üîÑ Starting polling for article ${articleId}`);
          checkSummaryProgress(articleId);
          console.log(`‚úÖ checkSummaryProgress called for article ${articleId}`);
        } else {
          const errorData = await response.json();
          console.log(`‚ùå Summary request failed:`, errorData);
          showError(articleId, errorData.error || 'Ë¶ÅÁ¥Ñ„É™„ÇØ„Ç®„Çπ„Éà„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
        }
      } catch (error) {
        console.error(`‚ùå Error in requestSummary for article ${articleId}:`, error);
        showError(articleId, '„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü');
      }
    }
    
    // Ë¶ÅÁ¥ÑÈÄ≤Ë°åÁä∂Ê≥Å„Çí„ÉÅ„Çß„ÉÉ„ÇØ
    async function checkSummaryProgress(articleId, attempts = 0) {
      console.log(`üöÄ Starting checkSummaryProgress for article ${articleId}, attempt ${attempts + 1}`);
      
      if (attempts > 30) { // ÊúÄÂ§ß30ÂõûÔºàÁ¥Ñ5ÂàÜÔºâ
        console.log(`‚è∞ Timeout reached for article ${articleId} after ${attempts} attempts`);
        hideProgress(articleId);
        showError(articleId, 'Ë¶ÅÁ¥ÑÂá¶ÁêÜ„Åå„Çø„Ç§„É†„Ç¢„Ç¶„Éà„Åó„Åæ„Åó„Åü');
        return;
      }
      
      try {
        console.log(`üì° Fetching summary status for article ${articleId}...`);
        const response = await fetch(`${API_BASE}/api/articles/${articleId}/summary`);
        console.log(`üì° Response status: ${response.status} ${response.statusText}`);
        
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const data = await response.json();
        
        // „Éá„Éê„ÉÉ„Ç∞„É≠„Ç∞Âº∑Âåñ
        console.log(`üîç Full API response for article ${articleId}:`, data);
        console.log(`üîç Detailed checking summary for article ${articleId} (attempt ${attempts + 1}):`, {
          summary_status: data.summary_status,
          request_status: data.request_status,
          has_summary_text: !!data.summary_text,
          summary_length: data.summary_text ? data.summary_text.length : 0,
          error_message: data.error_message,
          request_created: data.request_created,
          request_completed: data.request_completed
        });
        
        // Êù°‰ª∂„ÉÅ„Çß„ÉÉ„ÇØ„ÅÆË©≥Á¥∞„É≠„Ç∞
        const isRequestCompleted = data.request_status === 'completed';
        const isSummaryCompleted = data.summary_status === 'completed';
        const hasSummaryText = !!data.summary_text;
        
        console.log(`üîç Condition check:`, {
          isRequestCompleted,
          isSummaryCompleted,
          hasSummaryText,
          condition1: isRequestCompleted || isSummaryCompleted,
          finalCondition: (isRequestCompleted || isSummaryCompleted) && hasSummaryText
        });
        
        if ((isRequestCompleted || isSummaryCompleted) && hasSummaryText) {
          // Ë¶ÅÁ¥ÑÂÆå‰∫Ü
          console.log(`‚úÖ Summary completion detected for article ${articleId}!`);
          console.log(`‚úÖ Summary preview:`, data.summary_text.substring(0, 50) + '...');
          
          try {
            hideProgress(articleId);
            updateProgress(articleId, 100, 'Ë¶ÅÁ¥ÑÂÆå‰∫ÜÔºÅ');
            console.log(`üéâ Progress updated to 100% for article ${articleId}`);
            
            setTimeout(() => {
              console.log(`üîÑ Displaying summary in-place for article ${articleId}`);
              hideProgress(articleId);
              
              // Êó¢Â≠ò„ÅÆË®ò‰∫ãË¶ÅÁ¥†„ÇíË¶ã„Å§„Åë„Å¶„ÄÅ„Åù„ÅÆÂ†¥„ÅßË¶ÅÁ¥Ñ„ÇíË°®Á§∫
              const articleEl = document.querySelector(`[data-id="${articleId}"]`);
              if (articleEl) {
                // Êó¢Â≠ò„ÅÆË¶ÅÁ¥Ñ„Ç®„É™„Ç¢„ÇíÊé¢„Åô
                let summaryDiv = articleEl.querySelector('.summary');
                if (!summaryDiv) {
                  // Ë¶ÅÁ¥Ñ„Ç®„É™„Ç¢„ÅåÂ≠òÂú®„Åó„Å™„ÅÑÂ†¥Âêà„ÅØÊñ∞„Åó„Åè‰ΩúÊàê
                  summaryDiv = document.createElement('div');
                  summaryDiv.className = 'summary';
                  
                  // actions„ÅÆÂæå„Å´ÊåøÂÖ•
                  const actionsDiv = articleEl.querySelector('.actions');
                  if (actionsDiv) {
                    actionsDiv.insertAdjacentElement('afterend', summaryDiv);
                  }
                }
                
                // Ë¶ÅÁ¥ÑÂÜÖÂÆπ„ÇíË°®Á§∫ÔºàÊîπË°å„Çí<br>„Å´Â§âÊèõÔºâ
                summaryDiv.innerHTML = data.summary_text.replace(/\n/g, '<br>');
                console.log(`üìÑ Summary displayed in-place for article ${articleId}`);
                
                // Ë¶ÅÁ¥Ñ„Éú„Çø„É≥„ÇíÊõ¥Êñ∞
                const button = document.getElementById(`summary-btn-${articleId}`);
                if (button) {
                  button.textContent = 'Ë¶ÅÁ¥ÑÂÆå‰∫Ü';
                  button.disabled = true;
                }
                
                // Èü≥Â£∞Ë¶ÅÁ¥Ñ„Éú„Çø„É≥„ÇÇÊõ¥Êñ∞
                const audioButton = document.getElementById(`audio-summary-btn-${articleId}`);
                if (audioButton) {
                  audioButton.textContent = 'Ë¶ÅÁ¥ÑÂÆå‰∫Ü';
                  audioButton.disabled = true;
                }
              } else {
                // Ë®ò‰∫ãË¶ÅÁ¥†„ÅåË¶ã„Å§„Åã„Çâ„Å™„ÅÑÂ†¥Âêà„ÅØÂæìÊù•ÈÄö„Çä„É™„É≠„Éº„Éâ
                console.log(`üîÑ Article element not found, reloading articles for ${articleId}`);
                loadArticles();
              }
            }, 1000);
          } catch (uiError) {
            console.error(`‚ùå UI update error for article ${articleId}:`, uiError);
          }
          
        } else if (data.request_status === 'failed' || data.summary_status === 'failed') {
          // Ë¶ÅÁ¥ÑÂ§±Êïó
          console.log(`‚ùå Summary failed for article ${articleId}:`, data.error_message);
          hideProgress(articleId);
          showError(articleId, data.error_message || 'Ë¶ÅÁ¥ÑÂá¶ÁêÜ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
          const button = document.getElementById(`summary-btn-${articleId}`);
          if (button) {
            button.disabled = false;
            button.textContent = 'Ë¶ÅÁ¥Ñ„ÇíÂÜçË©¶Ë°å';
          }
        } else {
          // „Åæ„Å†Âá¶ÁêÜ‰∏≠ - „Éó„É≠„Ç∞„É¨„ÇπÊõ¥Êñ∞
          console.log(`‚è≥ Still processing article ${articleId}, will check again in 10 seconds...`);
          const progressText = getProgressText(attempts);
          const progressValue = Math.min(90, (attempts / 30) * 90);
          updateProgress(articleId, progressValue, progressText);
          
          console.log(`‚è∞ Setting timeout for next check of article ${articleId} in 10 seconds`);
          setTimeout(() => {
            console.log(`‚è∞ Timeout triggered, calling checkSummaryProgress again for article ${articleId}`);
            checkSummaryProgress(articleId, attempts + 1);
          }, 10000);
        }
      } catch (error) {
        console.error(`‚ùå Error checking summary progress for article ${articleId}:`, error);
        console.log(`‚è∞ Setting retry timeout for article ${articleId} in 10 seconds due to error`);
        setTimeout(() => {
          console.log(`‚è∞ Error retry timeout triggered for article ${articleId}`);
          checkSummaryProgress(articleId, attempts + 1);
        }, 10000);
      }
    }
    
    // „Éó„É≠„Ç∞„É¨„ÇπË°®Á§∫
    function showProgress(articleId, text) {
      console.log(`üìä showProgress called for article ${articleId} with text: "${text}"`);
      const progressContainer = document.getElementById(`progress-container-${articleId}`);
      if (progressContainer) {
        progressContainer.style.display = 'block';
        console.log(`üìä Progress container shown for article ${articleId}`);
        updateProgress(articleId, 10, text);
      } else {
        console.error(`‚ùå Progress container not found for article ${articleId}`);
      }
    }
    
    // „Éó„É≠„Ç∞„É¨„ÇπÊõ¥Êñ∞
    function updateProgress(articleId, percentage, text) {
      console.log(`üìä updateProgress called for article ${articleId}: ${percentage}%, "${text}"`);
      const progressFill = document.getElementById(`progress-fill-${articleId}`);
      const progressText = document.getElementById(`progress-text-${articleId}`);
      
      if (progressFill) {
        progressFill.style.width = `${percentage}%`;
        console.log(`üìä Progress fill updated to ${percentage}% for article ${articleId}`);
      } else {
        console.error(`‚ùå Progress fill element not found for article ${articleId}`);
      }
      
      if (progressText) {
        progressText.textContent = text;
        console.log(`üìä Progress text updated to "${text}" for article ${articleId}`);
      } else {
        console.error(`‚ùå Progress text element not found for article ${articleId}`);
      }
    }
    
    // „Éó„É≠„Ç∞„É¨„ÇπÈùûË°®Á§∫
    function hideProgress(articleId) {
      console.log(`üìä hideProgress called for article ${articleId}`);
      const progressContainer = document.getElementById(`progress-container-${articleId}`);
      if (progressContainer) {
        progressContainer.style.display = 'none';
        console.log(`üìä Progress container hidden for article ${articleId}`);
      } else {
        console.error(`‚ùå Progress container not found for hideProgress for article ${articleId}`);
      }
    }
    
    // ÈÄ≤Ë°åÁä∂Ê≥Å„Å´Âøú„Åò„Åü„ÉÜ„Ç≠„Çπ„Éà„ÇíÂèñÂæó
    function getProgressText(attempts) {
      if (attempts < 5) {
        return '„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíÂàÜÊûê‰∏≠...';
      } else if (attempts < 10) {
        return 'Èü≥Â£∞„ÇíÂá¶ÁêÜ‰∏≠...';
      } else if (attempts < 20) {
        return 'AIË¶ÅÁ¥Ñ„ÇíÁîüÊàê‰∏≠...';
      } else {
        return 'ÊúÄÁµÇÂá¶ÁêÜ‰∏≠...';
      }
    }
    
    // „Ç®„É©„Éº„É°„ÉÉ„Çª„Éº„Ç∏„ÇíË°®Á§∫
    function showError(articleId, message) {
      const errorElement = document.getElementById(`error-message-${articleId}`);
      if (errorElement) {
        // „Ç®„É©„Éº„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÊîπÂñÑ„Åó„Å¶Ë°®Á§∫
        let improvedMessage = message;
        
        // Èü≥Â£∞„Éï„Ç°„Ç§„É´„Çµ„Ç§„Ç∫„Ç®„É©„Éº„ÅÆÂ†¥Âêà„ÄÅ‰ª£ÊõøÊ°à„ÇíÊèêÁ§∫
        if (message.includes('Èü≥Â£∞„Éï„Ç°„Ç§„É´„ÅåÂ§ß„Åç„Åô„Åé„Åæ„Åô') || message.includes('Audio file too large')) {
          improvedMessage += '\n\nüí° ÂØæÂá¶Ê≥ïÔºö\n„Éª„Çà„ÇäÁü≠„ÅÑÈü≥Â£∞„Éï„Ç°„Ç§„É´„Çí„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ\n„ÉªÊâãÂãïË¶ÅÁ¥ÑÊ©üËÉΩ„Çí„ÅîÂà©Áî®„Åè„Å†„Åï„ÅÑ';
        }
        
        // RSS feed„Ç®„É©„Éº„ÅÆÂ†¥Âêà„ÄÅ‰ª£ÊõøÊ°à„ÇíÊèêÁ§∫
        if (message.includes('RSS Feed') || message.includes('RSS')) {
          improvedMessage += '\n\nüí° ÂØæÂá¶Ê≥ïÔºö\n„ÉªÊâãÂãïË¶ÅÁ¥ÑÊ©üËÉΩ„Çí„ÅîÂà©Áî®„Åè„Å†„Åï„ÅÑ\n„ÉªÁõ¥Êé•Èü≥Â£∞„Éï„Ç°„Ç§„É´URL„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅØ„Åù„Å°„Çâ„Çí„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ';
        }
        
        // Whisper API„Ç®„É©„Éº„ÅÆÂ†¥Âêà„ÄÅ‰ª£ÊõøÊ°à„ÇíÊèêÁ§∫
        if (message.includes('Èü≥Â£∞Ë™çË≠ò') || message.includes('Ëª¢ÂÜô')) {
          improvedMessage += '\n\nüí° ÂØæÂá¶Ê≥ïÔºö\n„ÉªÈü≥Â£∞„Éï„Ç°„Ç§„É´„ÅÆÂìÅË≥™„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ\n„ÉªÊâãÂãïË¶ÅÁ¥ÑÊ©üËÉΩ„Çí„ÅîÂà©Áî®„Åè„Å†„Åï„ÅÑ';
        }
        
        errorElement.innerHTML = improvedMessage.replace(/\n/g, '<br>');
        errorElement.style.display = 'block';
        errorElement.style.color = '#dc3545';
        errorElement.style.backgroundColor = '#f8d7da';
        errorElement.style.border = '1px solid #f5c6cb';
        errorElement.style.borderRadius = '4px';
        errorElement.style.padding = '0.5rem';
        errorElement.style.marginTop = '0.5rem';
        errorElement.style.fontSize = '0.9rem';
        errorElement.style.lineHeight = '1.4';
      }
    }
    
    // Ë®ò‰∫ãÊõ¥Êñ∞
    async function refreshArticles() {
      try {
        const response = await fetch(`${API_BASE}/api/feeds/refresh`, {
          method: 'POST'
        });
        
        if (response.ok) {
          const data = await response.json();
          alert(`${data.processedCount} ÂÄã„ÅÆFeed„ÇíÊõ¥Êñ∞„Åó„Åæ„Åó„Åü`);
          
          // Ë®ò‰∫ã‰∏ÄË¶ß„Çí„ÇØ„É™„Ç¢„Åó„Å¶„Åã„ÇâÊñ∞„Åó„ÅÑË®ò‰∫ã„ÅÆ„Åø„ÇíË™≠„ÅøËæº„Åø
          const container = document.getElementById('articles-container');
          container.innerHTML = '';
          currentOffset = 0;
          
          // Êú™Ë™≠Ë®ò‰∫ã„ÅÆ„Åø„ÇíË°®Á§∫„Åô„Çã„Åü„ÇÅ„Å´„ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ„ÇíON„Å´„Åô„Çã
          const unreadOnlyCheckbox = document.getElementById('unread-only');
          if (unreadOnlyCheckbox) {
            unreadOnlyCheckbox.checked = true;
          }
          
          loadArticles();
        }
      } catch (error) {
        console.error('Error refreshing articles:', error);
      }
    }

    // Product HuntÊõ¥Êñ∞
    async function refreshProductHunt() {
      try {
        const button = event.target;
        button.disabled = true;
        button.textContent = 'üîÑ Êõ¥Êñ∞‰∏≠...';
        
        const response = await fetch(`${API_BASE}/api/feeds/refresh-producthunt`, {
          method: 'POST'
        });
        
        if (response.ok) {
          const data = await response.json();
          alert(`Product HuntÊõ¥Êñ∞ÂÆå‰∫Ü: ${data.newApps} ÂÄã„ÅÆÊñ∞„Åó„ÅÑ„Ç¢„Éó„É™„ÇíËøΩÂä†„Åó„Åæ„Åó„Åü`);
          
          // Ë®ò‰∫ã‰∏ÄË¶ß„Çí„ÇØ„É™„Ç¢„Åó„Å¶„Åã„ÇâÊñ∞„Åó„ÅÑË®ò‰∫ã„ÅÆ„Åø„ÇíË™≠„ÅøËæº„Åø
          const container = document.getElementById('articles-container');
          container.innerHTML = '';
          currentOffset = 0;
          
          // Êú™Ë™≠Ë®ò‰∫ã„ÅÆ„Åø„ÇíË°®Á§∫„Åô„Çã„Åü„ÇÅ„Å´„ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ„ÇíON„Å´„Åô„Çã
          const unreadOnlyCheckbox = document.getElementById('unread-only');
          if (unreadOnlyCheckbox) {
            unreadOnlyCheckbox.checked = true;
          }
          
          loadArticles();
        } else {
          const errorData = await response.json();
          let errorMessage = 'Unknown error';
          
          if (response.status === 503 && errorData.message && errorData.message.includes('token not configured')) {
            errorMessage = `Product Hunt APIË®≠ÂÆö„Ç®„É©„Éº:\n\n${errorData.message}\n\nË®≠ÂÆöÊâãÈ†Ü:\n1. https://api.producthunt.com/v2/docs „Å´„Ç¢„ÇØ„Çª„Çπ\n2. „Ç¢„Éó„É™„Çí‰ΩúÊàê„Åó„Å¶API token„ÇíÂèñÂæó\n3. .env„Éï„Ç°„Ç§„É´„Å´PRODUCTHUNT_API_TOKEN„ÇíË®≠ÂÆö`;
          } else if (response.status === 401) {
            errorMessage = `Product Hunt APIË™çË®º„Ç®„É©„Éº:\n\n${errorData.message}\n\nAPI token„ÅåÁÑ°Âäπ„Åæ„Åü„ÅØÊúüÈôêÂàá„Çå„ÅÆÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ`;
          } else if (response.status === 429) {
            errorMessage = `Product Hunt API„É¨„Éº„ÉàÂà∂Èôê:\n\n${errorData.message}\n\nÊï∞ÂàÜÂæå„Å´ÂÜçË©¶Ë°å„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`;
          } else if (response.status === 503 && errorData.message && errorData.message.includes('Cannot connect')) {
            errorMessage = `Product Hunt APIÊé•Á∂ö„Ç®„É©„Éº:\n\n${errorData.message}\n\n„Ç§„É≥„Çø„Éº„Éç„ÉÉ„ÉàÊé•Á∂ö„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`;
          } else {
            errorMessage = `Product HuntÊõ¥Êñ∞„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:\n\n${errorData.message || errorData.error || 'Unknown error'}`;
          }
          
          alert(errorMessage);
        }
      } catch (error) {
        console.error('Error refreshing Product Hunt:', error);
        alert('Product HuntÊõ¥Êñ∞‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü');
      } finally {
        const button = event.target;
        button.disabled = false;
        button.textContent = 'üöÄ Product HuntÊõ¥Êñ∞';
      }
    }
    
    // FeedÁÆ°ÁêÜ
    async function loadFeeds() {
      try {
        const response = await fetch(`${API_BASE}/api/feeds`);
        const feeds = await response.json();
        
        const list = document.getElementById('feeds-list');
        list.innerHTML = '';
        
        feeds.forEach(feed => {
          const li = document.createElement('li');
          li.className = 'feed-item';
          li.innerHTML = `
            <div>
              <strong>${feed.title || '„Çø„Ç§„Éà„É´„Å™„Åó'}</strong><br>
              <small>${feed.url}</small>
            </div>
            <button onclick="deleteFeed(${feed.id})">ÂâäÈô§</button>
          `;
          list.appendChild(li);
        });
      } catch (error) {
        console.error('Error loading feeds:', error);
      }
    }
    
    async function addFeed() {
      const url = document.getElementById('feed-url').value.trim();
      if (!url) {
        alert('RSS Feed URL„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
        return;
      }
      
      // URL„ÅÆÂü∫Êú¨ÁöÑ„Å™Â¶•ÂΩìÊÄß„ÉÅ„Çß„ÉÉ„ÇØ
      try {
        new URL(url);
      } catch (e) {
        alert('ÊúâÂäπ„Å™URL„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
        return;
      }
      
      // „Çà„ÇäÂÖ∑‰ΩìÁöÑ„Å™„Çª„É¨„ÇØ„Çø„Éº„Çí‰ΩøÁî®„Åó„Å¶„Ç®„É©„Éº„ÇíÂõûÈÅø
      const addButton = document.querySelector('.feed-form button[onclick="addFeed()"]') || 
                       document.querySelector('.feed-form button');
      const originalText = addButton.textContent;
      
      console.log('üöÄ Starting feed addition:', url);
      console.log('üîß Button found:', !!addButton);
      
      if (!addButton) {
        alert('„Ç®„É©„Éº: ËøΩÂä†„Éú„Çø„É≥„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„ÄÇ„Éö„Éº„Ç∏„ÇíÂÜçË™≠„ÅøËæº„Åø„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
        return;
      }
      
      try {
        // UI„ÇíÊõ¥Êñ∞„Åó„Å¶„É¶„Éº„Ç∂„Éº„Å´Âá¶ÁêÜ‰∏≠„ÇíÁ§∫„Åô
        addButton.disabled = true;
        addButton.textContent = 'Âá¶ÁêÜ‰∏≠...';
        
        console.log('üì° Sending POST request to /api/feeds');
        console.log('üì° API_BASE:', API_BASE);
        console.log('üì° Full URL:', `${API_BASE}/api/feeds`);
        
        // „Çø„Ç§„É†„Ç¢„Ç¶„Éà„ÇíË®≠ÂÆöÔºà30ÁßíÔºâ
        const controller = new AbortController();
        const timeoutId = setTimeout(() => {
          controller.abort();
          console.log('‚è∞ Request aborted due to timeout');
        }, 30000);
        
        const response = await fetch(`${API_BASE}/api/feeds`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ url }),
          signal: controller.signal
        });
        
        clearTimeout(timeoutId);
        
        console.log('üì° Response received:', response.status, response.statusText);
        
        if (response.ok) {
          const result = await response.json();
          console.log('‚úÖ Feed addition successful:', result);
          
          document.getElementById('feed-url').value = '';
          loadFeeds();
          
          // ÊàêÂäü„É°„ÉÉ„Çª„Éº„Ç∏„ÇíË©≥Á¥∞„Å´Ë°®Á§∫
          const articleCount = result.articlesAdded || 0;
          const message = `‚úÖ ${result.title || 'Feed'}„ÇíËøΩÂä†„Åó„Åæ„Åó„Åü\nüìÑ ${articleCount}‰ª∂„ÅÆË®ò‰∫ã„ÇíÂèñÂæó`;
          alert(message);
          
        } else {
          const error = await response.json();
          console.error('‚ùå Feed addition error:', error);
          console.error('Full error response:', {
            status: response.status,
            statusText: response.statusText,
            error: error
          });
          
          let errorMessage = '';
          if (response.status === 400) {
            errorMessage = `‚ùå ÁÑ°Âäπ„Å™RSS Feed URL\n\nË©≥Á¥∞: ${error.error || 'URL„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ'}`;
          } else if (response.status === 409) {
            errorMessage = `‚ÑπÔ∏è „Åì„ÅÆFeed„ÅØÊó¢„Å´ÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åô\n\nÂâäÈô§Ê∏à„Åø„ÅÆFeed„ÇíÂÜçÁôªÈå≤„Åó„Åü„ÅÑÂ†¥Âêà„ÅØ„ÄÅÂêå„ÅòURL„ÇíÂÜçÂ∫¶ÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`;
          } else if (response.status === 500) {
            errorMessage = `‚ùå „Çµ„Éº„Éê„Éº„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü\n\nË©≥Á¥∞: ${error.error || '„Åó„Å∞„Çâ„ÅèÂæÖ„Å£„Å¶„Åã„ÇâÂÜçË©¶Ë°å„Åó„Å¶„Åè„Å†„Åï„ÅÑ'}\n\nURL: ${url}`;
          } else {
            errorMessage = `‚ùå FeedËøΩÂä†„Ç®„É©„Éº (${response.status})\n\nË©≥Á¥∞: ${error.error || '‰∏çÊòé„Å™„Ç®„É©„Éº'}\n\nURL: ${url}`;
          }
          
          alert(errorMessage);
        }
      } catch (error) {
        console.error('‚ùå Network error adding feed:', error);
        console.error('Error details:', {
          message: error.message,
          name: error.name,
          stack: error.stack
        });
        
        let networkErrorMessage = '‚ùå „Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü\n\n';
        
        if (error.name === 'TypeError' && error.message.includes('fetch')) {
          networkErrorMessage += 'ÂéüÂõ†: „Çµ„Éº„Éê„Éº„Å´Êé•Á∂ö„Åß„Åç„Åæ„Åõ„Çì\n';
          networkErrorMessage += 'ÂØæÂá¶: „Éç„ÉÉ„Éà„ÉØ„Éº„ÇØÊé•Á∂ö„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ';
        } else if (error.name === 'AbortError') {
          networkErrorMessage += 'ÂéüÂõ†: „É™„ÇØ„Ç®„Çπ„Éà„Åå„Çø„Ç§„É†„Ç¢„Ç¶„Éà„Åó„Åæ„Åó„ÅüÔºà30ÁßíÔºâ\n';
          networkErrorMessage += 'ÂØæÂá¶: RSS „Éï„Ç£„Éº„Éâ„ÅÆÂá¶ÁêÜ„Å´ÊôÇÈñì„Åå„Åã„Åã„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ\n';
          networkErrorMessage += '„Åó„Å∞„Çâ„ÅèÂæÖ„Å£„Å¶„Åã„ÇâÂÜçË©¶Ë°å„Åô„Çã„Åã„ÄÅÂà•„ÅÆ„Éï„Ç£„Éº„Éâ„Çí„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ';
        } else {
          networkErrorMessage += `Ë©≥Á¥∞: ${error.message}\n`;
          networkErrorMessage += `„Ç®„É©„Éº„Çø„Ç§„Éó: ${error.name}\n`;
          networkErrorMessage += `URL: ${url}\n`;
          networkErrorMessage += '„Éö„Éº„Ç∏„ÇíÊõ¥Êñ∞„Åó„Å¶ÂÜçË©¶Ë°å„Åó„Å¶„Åè„Å†„Åï„ÅÑ';
        }
        
        alert(networkErrorMessage);
      } finally {
        // UI„ÇíÂÖÉ„Å´Êàª„Åô
        addButton.disabled = false;
        addButton.textContent = originalText;
        console.log('üîÑ Feed addition process completed');
      }
    }
    
    async function deleteFeed(feedId) {
      if (!confirm('„Åì„ÅÆFeed„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) return;
      
      try {
        const response = await fetch(`${API_BASE}/api/feeds/${feedId}`, {
          method: 'DELETE'
        });
        
        if (response.ok) {
          loadFeeds();
        }
      } catch (error) {
        console.error('Error deleting feed:', error);
      }
    }
    
    // ÊâãÂãïË¶ÅÁ¥Ñ„É¢„Éº„ÉÄ„É´Èñ¢ÈÄ£
    let currentArticleId = null;
    
    function showManualSummaryModal(articleId) {
      currentArticleId = articleId;
      const modal = document.getElementById('manual-summary-modal');
      const textInput = document.getElementById('manual-text-input');
      
      textInput.value = '';
      modal.style.display = 'block';
      textInput.focus();
    }
    
    function closeManualSummaryModal() {
      const modal = document.getElementById('manual-summary-modal');
      modal.style.display = 'none';
      currentArticleId = null;
    }
    
    async function submitManualSummary() {
      const textInput = document.getElementById('manual-text-input');
      const manualText = textInput.value.trim();
      
      if (!manualText) {
        alert('„ÉÜ„Ç≠„Çπ„Éà„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
        return;
      }
      
      if (!currentArticleId) {
        alert('„Ç®„É©„Éº: Ë®ò‰∫ãID„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„ÄÇ');
        return;
      }
      
      try {
        const response = await fetch(`${API_BASE}/api/articles/${currentArticleId}/summarize`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ manual_text: manualText })
        });
        
        if (response.ok) {
          closeManualSummaryModal();
          
          // Ë¶ÅÁ¥ÑÂá¶ÁêÜ‰∏≠„ÅÆË°®Á§∫„ÇíÊõ¥Êñ∞
          const button = document.getElementById(`summary-btn-${currentArticleId}`);
          if (button) {
            button.disabled = true;
            button.textContent = 'Ë¶ÅÁ¥Ñ‰∏≠...';
          }
          
          // „Éó„É≠„Ç∞„É¨„Çπ„Éê„Éº„ÇíË°®Á§∫
          showProgress(currentArticleId, 'ÊâãÂãï„ÉÜ„Ç≠„Çπ„Éà„ÇíÂá¶ÁêÜ‰∏≠...');
          
          // ÈÄ≤Ë°åÁä∂Ê≥Å„Çí„ÉÅ„Çß„ÉÉ„ÇØ
          checkSummaryProgress(currentArticleId);
          
        } else {
          const errorData = await response.json();
          alert(`„Ç®„É©„Éº: ${errorData.error || 'Ë¶ÅÁ¥Ñ„É™„ÇØ„Ç®„Çπ„Éà„Å´Â§±Êïó„Åó„Åæ„Åó„Åü'}`);
        }
      } catch (error) {
        console.error('Error submitting manual summary:', error);
        alert('„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ');
      }
    }
    
    // „É¢„Éº„ÉÄ„É´Â§ñ„ÇØ„É™„ÉÉ„ÇØ„ÅßÈñâ„Åò„Çã
    window.onclick = function(event) {
      const modal = document.getElementById('manual-summary-modal');
      if (event.target === modal) {
        closeManualSummaryModal();
      }
    }
    
    // ÂàùÊúüÂåñ
    document.addEventListener('DOMContentLoaded', () => {
      loadArticles();
    });
  </script>
</body>
</html>